{% from 'vars/globals.map.jinja' import GLOBALS %}
{% set REDIS_NODES = [] %}
{% set LOGSTASH_NODES = [] %}
{% set node_data = salt['pillar.get']('logstash:nodes', {GLOBALS.role.split('-')[1]: {GLOBALS.hostname: {'ip': GLOBALS.node_ip}}}) %}

{% for node_type, node_details in node_data.items() | sort %}
{%   if GLOBALS.role in ['so-searchnode', 'so-standalone', 'so-managersearch'] %}
{%     if node_type in ['manager', 'managersearch', 'standalone', 'receiver' ] %}
{%       for hostname in node_data[node_type].keys() %}
{%         do REDIS_NODES.append({hostname:node_details[hostname].ip}) %}
{%       endfor %}
{%     endif %}
{%   else %}
{%     do REDIS_NODES.append({GLOBALS.hostname:GLOBALS.node_ip}) %}
{%   endif %}

{%   for hostname in node_data[node_type].keys() %}
{%     do LOGSTASH_NODES.append({hostname:node_details[hostname].ip}) %}
{%   endfor %}
{% endfor %}
