{%- set MASTER = salt['grains.get']('master') -%}
{%- set KRATOSKEY = salt['pillar.get']('static:kratoskey', '') -%}

selfservice:
  strategies:
    password:
      enabled: true

  verify:
    return_to: https://{{ MASTER }}/

  logout:
    redirect_to: https://{{ MASTER }}/login/

  login:
    request_lifespan: 10m
    after:
      password:
        -
          job: session
        -
          job: redirect
          config:
            default_redirect_url: https://{{ MASTER }}/
            allow_user_defined_redirect: true

  registration:
    request_lifespan: 10m
    after:
      password:
        -
          job: verify
        -
          job: session
        -
          job: redirect
          config:
            default_redirect_url: https://{{ MASTER }}/
            allow_user_defined_redirect: true

log:
  level: debug

secrets:
  session:
    - {{ KRATOSKEY }}

urls:
  login_ui: https://{{ MASTER }}/login/
  registration_ui: https://{{ MASTER }}/login/
  error_ui: https://{{ MASTER }}/login/
  profile_ui: https://{{ MASTER }}/
  verify_ui: https://{{ MASTER }}/
  mfa_ui: https://{{ MASTER }}/

  self:
    public: https://{{ MASTER }}/auth/
    admin: https://{{ MASTER }}/kratos/
  default_return_to: https://{{ MASTER }}/
  whitelisted_return_to_domains:
    - http://127.0.0.1

hashers:
  argon2:
    parallelism: 2
    memory: 16384
    iterations: 3
    salt_length: 16
    key_length: 32

identity:
  traits:
    default_schema_url: file:///kratos-conf/schema.json

courier:
  smtp:
    connection_uri: smtps://{{ MASTER }}:25